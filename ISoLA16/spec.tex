\section{From Whence the Specification}~\label{sec:req} Sound systems
engineering practices as well as regulatory guidelines typically
mandate safety-critical systems have detailed written requirements as
well as a thorough safety assessment. Safety is a system level
property so if RV is to provide safety guarantees, then the monitor
specifications must flow down from the requirements and safety
analyses.  Indeed, Rushby's study~\cite{rvRushby,RushbyAIAA09}
demonstrated that a convincing safety case
for an IA system protected by RV demands evidence that the monitor
specifications are derived from validated requirements and,  that the monitor specifications should include checks of the
assumptions on which safe operation of the system rests are indeed
satisfied.

\paragraph{Challenge:} \emph{ Monitor specifications should derive from
  system level requirements and assumptions that have been validated
  by domain experts.} 


\paragraph{}  As
machine intelligence replaces people, RV is likely to be called upon
to enforce safe behaviors that humans began learning in early
childhood.  For an autonomous automobile controlled by machine
learning, a safety property might be ``do not hit a pedestrian'' or
``do not behave erratically'', but what do these statements mean
precisely?  A more precise statement such as ``maintain five meters
distance from any object in the vehicle path'' may be more formal, but
is that what is the expert wanted?  Phrases like ``erratic behavior''
may seem reasonable to a mature adult, but formalizing such statements
can be an open ended problem.

\paragraph{Challenge:} \emph{Precisely formalize safety properties  in
  a decidable logic.}

\paragraph{Copilot Approach:} We are conducting case studies informed
by collaborations with colleagues who are developing new concepts that
will enable aircraft to perform autonomous flight by self-optimizing
their four-dimensional trajectories while conforming to constraints
such as required times of arrival generated by air-traffic service
providers on the ground. Many of the proposed
algorithms~\cite{KarrVRC} do not behave with the predictability of
conventional systems.  Consequently, it is not possible to provide the
required level of assurance that the newly computed trajectories
preserve safe aircraft separation.  The separation requirement for two aircraft is specified by a minimum
horizontal separation $D$ (typically, $5$ nautical miles).
Fortuitously, colleagues at NASA have discovered analytical formula,
called \emph{criteria}~\cite{NM2011NASA}, that characterize resolution
maneuvers that both ensure safe separation when one aircraft maneuvers
and ensures separation when two conflicting aircraft both
maneuver. The criteria have been extensively validated by domain
experts who conducted sophisticated simulations as well as performing
formal mathematical proofs using the Prototype Verification System
(PVS) theorem prover. We have encoded these conditions as Copilot
specifications. The criteria for horizontal separation for two
aircraft is given as follows:
%$$ \texttt{horizontal\_criteria}(\bm{s}, \epsilon)(\bm{v'})
%\equiv  \bm{s} \cdot \bm{v'} \geq \epsilon  \frac{\sqrt{\bm{s} \cdot
%  \bm{s}  - D^2}} {D} \operatorname{det}(\bm{s},\bm{v'})$$ 

\begin{eqnarray*} \texttt{horiz\_criteria}(\bm{s}, \epsilon, \bm{v})
& \equiv &  \bm{s} \cdot \bm{v} \geq \epsilon  \frac{\sqrt{\bm{s} \cdot
  \bm{s}  - D^2}} {D} \operatorname{det}(\bm{s},\bm{v})  \\
& \wedge &  \epsilon \operatorname{det}(\bm{s},\bm{v})  \leq  0 
\end{eqnarray*}

\noindent 
where $\bm{s}$ is the relative position 
vector for the two aircraft, $\epsilon$ is $1$ or $-1,$  and 
$\bm{v}$ is the relative velocity vector after a planned maneuver. 
The position is  assumed to be given in Earth Centered Earth Fixed (ECEF)
coordinates.  This is easily encoded in  Copilot's EDSL as:

%\begin{lstlisting}[frame=single]
%scalar2dim :: Stream Double -> Stream Double -> Stream Double -> Stream Double -> Stream Double
%scalar2dim x1 y1 x2 y2 = (x1 * x2) + (y1 * y2)
%
%normsq2dim :: Stream Double -> Stream Double -> Stream Double
%normsq2dim x y = scalar2dim x y x y
%
%norm2dim :: Stream Double -> Stream Double -> Stream Double
%norm2dim x y = sqrt (normsq2dim x y)
%
%det2dim :: Stream Double -> Stream Double -> Stream Double -> Stream Double -> Stream Double
%det2dim x1 y1 x2 y2 = (x1 * y2) - (x2 * y1)
%
%----------------------------------------
%-- Horizontal Criterion for Conflict Resolution
%----------------------------------------
\begin{lstlisting}[frame=single]
hor_rr :: Stream Double -> Stream Double -> Stream Double
hor_rr sx sy= (sqrt $ (normsq2dim sx sy) - (minHorSep * minHorSep)) / (minHorSep)

horizontalCriterionForConflictResolution :: Stream Double -> Stream Double -> Stream Double -> Stream Double -> Stream Double -> Stream Bool
horizontalCriterionForConflictResolution sx sy e vx vy = ((scalar2dim sx sy vx vy) >= (e * (hor_rr sx sy e vx vy) * (det2dim sx sy vx vy)) ) && ( ((det2dim sx sy vx vy) *e)  <= 0.0)
\end{lstlisting}

Formalizing the assumptions about the reliability of communicating
aircraft position data is ongoing work.  A case study formalizing what
it means for a UAS to behave erratically is planned as future
work.  


%\begin{itemize}
%\item Safety-Critical that that are considered ultra-critical systems
% typically have detailed requirements
%
%\item established that only ``safety properties'' can be checked with
%  RV 
% \item For adaptive systems where RV is the entrusted repository of
%  predictability and guarantor of safety we must make sure that we are
%  actually checking properties based on formal requirements.
% \item Need to make sure that the RV safety properties are derived
%  from requirements. 
% \item Criteria based separation example an excellent example in that
%  has undergone extensive analysis both simulation and formal
%  analytical proof.  Assumptions are well spelled out. 
% \item NASA is investigating sophisticated AI based  flight management
%  software. Such systems cannot be certified by traditional means, but
%  the criteria can an can serve as the basis for RV. 
%\item EDSL we strive to build libraries allow specification in this
%  sort of notation. 
%\end{itemize}
%
%
%The obvious specification is simply check to see if the aircraft have
%violated separation and take corrective action.  system level
%needs demanded a specification that the aircract will not come into
%conflict meaning separation is not lost in at some time $t>0.$


%These are expressed as a collection of formula
%involving the position and velocity vectors of the two
%aircraft.

%,NMH14ATIO