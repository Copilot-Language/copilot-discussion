\section{From Whence the Specifications}~\label{sec:req}

If RV is to be used to ensure safety, then great care must be given to
the monitor specifications.  It is not sufficient to find a property
to monitor, a convincing safety case~\cite{Kelly98arguingsafety} will
require evidence that the monitor specifications do indeed provide the
advertised protection and some argument that they are complete.
Rushby's proposal~\cite{rvRushby,RushbyAIAA09} proposal for a using RV
in a safety case of IA systems is instructive in that the efficacy of
the monitor is paramount.  A safety case should fully enumerate the
set of assumptions on which safe operation of the system rests and the
monitor needs to test for the violation of these assumptions as well
as other safety criteria. 


 Sound systems engineering practices  as well
as regulatory guidelines such as ARP-476,  typically mandate safety-critical systems
have detailed written requirements and as well as a through safety
assessment.  It is crucial that the monitor specification be derived
from the safety analyses. Thus leading to our first challenge for
assured RV.
%\noindent\fbox{%
%    \parbox{\textwidth}{%

\paragraph{Challenge}   Monitor specifications should derive from system level
requirements and safety analyses. 


%    }%
%}



\paragraph{Example} The Copilot team have been collaborating with NASA
researchers working on new concepts that will enable aircraft to
perform autonomous flight by self-optimizing their four-dimensional
trajectories while conforming to constraints such as required times of
arrival generated by air-traffic service providers on the
ground. Proposals being investigated use genetic
algorithms~\cite{KarrVRC} and do not always behave with the
predictability of conventional systems. While these algorithms may
greatly improve the efficiency of the airspace Analysis has raised
safety concerns arising from the inability to guarantee an airspace
safety property that the aircraft maintain safe separation
distance. In the airspace system the separation requirement for two
aircraft is specified by a minimum horizontal separation $D$
(typically, $5$ nautical miles).  The obvious specification is
simply check to see if the aircraft have violated separation and take
corrective action.  Yet the system level needs demanded a specificatio
that the aircract will not come into conflict meaning separation is
not lost in at some time $t>0.$  Fortuitously,
colleagues at NASA have discovered analytical formula, called
\emph{criteria}~\cite{NM2011NASA,NMH14ATIO} that characterize those resolution maneuvers that both
ensure safe separation when one aircraft maneuvers and ensures
separation when two conflicting aircraft both
maneuver. These are expressed as a set of formula
involving the position and velocity vectors of the two
aircraft. Researchers have also enumerated a number of assumptions
that must hold for the formula to hold. The criteria have been
extensively validated  by domain experts emplying  sophisticated simulation as well as mathematical proof
using the Prototype Verification System (PVS) theorem prover. These
criteria were encoded as Copilot specificaitons. The criteria for
horizontal sepation for two aircradt  is given as follows:
$$ \texttt{horizontal\_criteria}(\bm{s}, \bm{v}, \epsilon)(\bm{v'})
\equiv  \bm{s} \cdot \bm{v'} \geq \epsilon  \frac{\sqrt{\bm{s} \cdot
  \bm{s}  - D^2}} {D} \operatorname{det}(\bm{s},\bm{v'})$$ 

where $\bm{s}$ and $\bm{v}$ are the  relative position and velocity
vectores for the two aircraft, $\epsilon$ is $1$ or $-1,$  and 
$\bm{v'}$ is the relative velocity vector after a planned maneuver. 

Encoding in  Copilot's EDSL as:

\begin{lstlisting}[frame=single]
scalar2dim :: Stream Double -> Stream Double -> Stream Double -> Stream Double -> Stream Double
scalar2dim x1 y1 x2 y2 = (x1 * x2) + (y1 * y2)

scalar3dim :: Stream Double -> Stream Double -> Stream Double -> Stream Double -> Stream Double -> Stream Double -> Stream Double
scalar3dim x1 y1 z1 x2 y2 z2 = (x1 * x2) + (y1 * y2) + (z1 * z2)

normsq2dim :: Stream Double -> Stream Double -> Stream Double
normsq2dim x y = scalar2dim x y x y

norm2dim :: Stream Double -> Stream Double -> Stream Double
norm2dim x y = sqrt (normsq2dim x y)

det2dim :: Stream Double -> Stream Double -> Stream Double -> Stream Double -> Stream Double
det2dim x1 y1 x2 y2 = (x1 * y2) - (x2 * y1)

----------------------------------------
-- Horizontal Criterion for Conflict Resolution
----------------------------------------

hor_rr :: Stream Double -> Stream Double -> Stream Double -> Stream Double -> Stream Double -> Stream Double
hor_rr sx sy e v'x v'y = (sqrt $ (normsq2dim sx sy) - (minHorSep * minHorSep)) / (minHorSep)

horizontalCriterionForConflictResolution :: Stream Double -> Stream Double -> Stream Double -> Stream Double -> Stream Double -> Stream Bool
horizontalCriterionForConflictResolution sx sy e v'x v'y = (scalar2dim sx sy v'x v'y) >= (e * (hor_rr sx sy e v'x v'y) * (det2dim sx sy v'x v'y))

\end{lstlisting}

%  In a small attempt to bridge the
%gap, between RV and the cyber-physical domain experts we are currently
%constructing libraries to make it easier to write specifications
%involving matrices and vectors.

We have fond case studies involving both domain and safety experts
invaluable at informing our research agenda  assured RV.

 








%\begin{itemize}
%\item Safety-Critical that that are considered ultra-critical systems
% typically have detailed requirements

%\item established that only ``safety properties'' can be checked with
%  RV 
% \item For adaptive systems where RV is the entrusted repository of
%  predictability and guarantor of safety we must make sure that we are
%  actually checking properties based on formal requirements.
% \item Need to make sure that the RV safety properties are derived
%  from requirements. 
% \item Criteria based separation example an excellent example in that
%  has undergone extensive analysis both simulation and formal
%  analytical proof.  Assumptions are well spelled out. 
% \item NASA is investigating sophisticated AI based  flight management
%  software. Such systems cannot be certified by traditional means, but
%  the criteria can an can serve as the basis for RV. 
%\item EDSL we strive to build libraries allow specification in this
%  sort of notation. 
%\end{itemize}


